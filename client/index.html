<html>
<head>
	<meta charset="utf-8">
	<title>Chat Room v0.0.1</title>
	<link rel="stylesheet" type="text/css" href="./style/main.css"/>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		/*
			bug : 聊天室人数不能做到同步更新
		*/
		var socket = io.connect('ws://localhost:3000');
		var name = prompt("please input your name:"); //本客户段的名字
		socket.emit('login', {userid : '1', username : name});
		//接受新用户提醒消息
		socket.on('welcome', function(data){
			//alert(data.msg);
			var tmp = "<p><font color=\"red\">";
			var tmp2= "</font></p>";
			$("div#ChatRoom").append(tmp+data.uname+"上线了!  "+"群内人数: "+data.unum+tmp2);
			if(data.to == 'all')
			{	
				//$("div#people").empty();
				var x;
				//for (x in data.people)
				//{
					$("div#people").append("<p id="+data.uname+">"+data.uname+"</p>");
				//}
			}
		});
		//用户离线提醒
		socket.on('leave', function(data){
			var tmp = "<p><font color=\"red\">";
			var tmp2= "</font></p>";
			$("div#ChatRoom").append(tmp+data.uname+"下线了!  "+"群内人数: "+data.unum+tmp2);
			$("p#"+data.uname).remove();
		});
		//接受新消息
		socket.on('message', function(data){
			//alert(data.msg);
			var tmp = "<p>";
			var tmp2= "</p>";
			var time = new Date().toLocaleString();
			$("div#ChatRoom").append(tmp+data.uname+"("+time+")"+" : "+data.say+tmp2);
		});
		//服务器断开
		socket.on('disconnect', function(){
			$("div#ChatRoom").append("<p><font color=\"red\">与服务器断开连接!!!</font></p>");
		});
		//服务器重新启动
		socket.on('reconnect', function(data){
			socket.emit('login', {userid : '1', username : name});
			$("div#ChatRoom").append("<p><font color=\"red\">与服务器重新连接!!!</font></p>");
		});
	</script>
	<script type="text/javascript" src="js/function.js"></script>
</head>

<body>
  <div id="ChatRoom">
  </div>
  <div id="people">
	<p>房间成员:</p>
  </div>
  <div id="input">
      <input type="text" maxlength="140" id="content" name="content">
      <button type="button" class="send" onclick="submit();">发送</button>
  </div>
</body>
</html>
